<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Amnam Client</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root {
      --main-bg: #0f1912;
      --main-text: #e0ffe5;
      --accent: #16a34a;
    }
    body {
      background: radial-gradient(circle at 20% 20%, #10291c, #0a0f0a 70%);
      background-size: 400% 400%;
      animation: gradientFlow 20s ease infinite;
      color: var(--main-text);
      font-family: sans-serif;
    }
    @keyframes gradientFlow {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    .fade-in {
      opacity: 0;
      transform: translateY(30px);
      animation: fadeIn 1s ease forwards;
    }
    @keyframes fadeIn {
      to { opacity: 1; transform: none; }
    }
    .gradient-border {
      background: linear-gradient(145deg, var(--accent), #14532d, var(--accent));
      background-size: 400% 400%;
      animation: gradientFlow 8s ease infinite;
    }
    .glowing-amnyam {
      width: 240px;
      transition: transform 0.4s ease;
      animation: glow 2s ease-in-out infinite alternate;
      filter: drop-shadow(0 0 20px var(--accent));
    }
    .glowing-amnyam:hover {
      transform: scale(1.1);
    }
    @keyframes glow {
      from { filter: drop-shadow(0 0 10px var(--accent)); }
      to { filter: drop-shadow(0 0 30px var(--accent)); }
    }
  </style>
</head>
<body>
<header class="flex justify-between items-center px-6 py-4 border-b border-green-800">
  <div class="flex items-center space-x-3">
    <img src="https://grizly.club/uploads/posts/2023-02/1676201923_grizly-club-p-klipart-am-nyam-2.png" class="w-8 h-8"/>
    <span class="text-2xl font-bold text-[var(--accent)]">Amnam Client</span>
  </div>
  <nav class="flex space-x-4 text-sm text-gray-300">
    <a href="#" onclick="showMain()">Главная</a>
    <a href="#" onclick="showProducts()">Товары</a>
    <a href="#" onclick="showProfile()">Профиль</a>
  </nav>
  <div class="space-x-2 text-sm text-white">
    <span id="profileInfo"></span>
    <button id="loginBtn" onclick="document.getElementById('loginModal').showModal()" class="bg-white text-black px-4 py-2 rounded">Войти</button>
    <button id="registerBtn" onclick="document.getElementById('registerModal').showModal()" class="bg-[var(--accent)] px-4 py-2 rounded">Регистрация</button>
  </div>
</header>

<main id="mainBlock" class="text-center py-16 px-4 fade-in">
  <h1 class="text-5xl font-bold mb-4">Amnam Client</h1>
  <p class="text-xl mb-6 text-[var(--accent)]">Лучший чит для Minecraft</p>
  <p class="max-w-xl mx-auto text-gray-300">Этот клиент обходит большинство античитов и идеально работает на популярных СНГ серверах.</p>
  <div class="mt-16 flex justify-center">
    <img src="https://grizly.club/uploads/posts/2023-02/thumbs/1676201934_grizly-club-p-klipart-am-nyam-36.png" onclick="alert('Промокод: amnam — скидка 30%')" class="glowing-amnyam cursor-pointer"/>
  </div>
</main>

<section id="products" class="py-16 px-4 fade-in hidden">
  <h2 class="text-3xl font-bold text-center mb-10">Товары</h2>
  <div class="grid md:grid-cols-3 gap-6 max-w-5xl mx-auto">
    <div class="gradient-border p-6 rounded-2xl shadow-xl hover:scale-105 text-center">
      <h3 class="text-xl font-bold mb-2">Навсегда — 350 ₽</h3>
      <button onclick="window.location.href='https://t.me/HECIIPABEDLIBOSTb'" class="mt-2 px-4 py-2 bg-[var(--accent)] rounded">Купить</button>
    </div>
    <div class="gradient-border p-6 rounded-2xl shadow-xl hover:scale-105 text-center">
      <h3 class="text-xl font-bold mb-2">Год — 250 ₽</h3>
      <button onclick="window.location.href='https://t.me/HECIIPABEDLIBOSTb'" class="mt-2 px-4 py-2 bg-[var(--accent)] rounded">Купить</button>
    </div>
    <div class="gradient-border p-6 rounded-2xl shadow-xl hover:scale-105 text-center">
      <h3 class="text-xl font-bold mb-2">Месяц — 150 ₽</h3>
      <button onclick="window.location.href='https://t.me/HECIIPABEDLIBOSTb'" class="mt-2 px-4 py-2 bg-[var(--accent)] rounded">Купить</button>
    </div>
  </div>
</section>

<dialog id="loginModal" class="rounded-xl p-6 bg-gray-800 text-white">
  <form method="dialog" onsubmit="login(); return false;">
    <h3 class="text-xl font-bold mb-4">Вход</h3>
    <input required id="loginNick" placeholder="Ник" class="w-full mb-3 px-3 py-2 rounded bg-gray-700">
    <input required id="loginPass" type="password" placeholder="Пароль" class="w-full mb-4 px-3 py-2 rounded bg-gray-700">
    <button class="bg-[var(--accent)] px-4 py-2 rounded">Войти</button>
  </form>
</dialog>

<dialog id="registerModal" class="rounded-xl p-6 bg-gray-800 text-white">
  <form method="dialog" onsubmit="register(); return false;">
    <h3 class="text-xl font-bold mb-4">Регистрация</h3>
    <input required id="regNick" placeholder="Ник" class="w-full mb-3 px-3 py-2 rounded bg-gray-700">
    <input required id="regPass" type="password" placeholder="Пароль" class="w-full mb-4 px-3 py-2 rounded bg-gray-700">
    <button class="bg-[var(--accent)] px-4 py-2 rounded">Зарегистрироваться</button>
  </form>
</dialog>

<script>
  function showMain() {
    document.getElementById('mainBlock').classList.remove('hidden');
    document.getElementById('products').classList.add('hidden');
    document.getElementById('profile')?.remove();
  }

  function showProducts() {
    document.getElementById('mainBlock').classList.add('hidden');
    document.getElementById('products').classList.remove('hidden');
    document.getElementById('profile')?.remove();
  }

  async function login() {
    const nickname = document.getElementById('loginNick').value;
    const password = document.getElementById('loginPass').value;

    const res = await fetch('http://localhost:3000/api/login', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({ nickname, password })
    });

    const data = await res.json();
    if (res.ok) {
      localStorage.setItem('uid', data.uid);
      localStorage.setItem('nickname', data.nickname);
      localStorage.setItem('is_admin', data.is_admin);

      if (data.is_admin) {
        window.location.href = "/admin.html";
      } else {
        showProfile();
      }
    } else {
      alert(data.error);
    }
  }

  async function register() {
    const nickname = document.getElementById('regNick').value;
    const password = document.getElementById('regPass').value;

    const res = await fetch('http://localhost:3000/api/register', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({ nickname, password })
    });

    const data = await res.json();
    if (res.ok) {
      localStorage.setItem('uid', data.uid);
      localStorage.setItem('nickname', data.nickname);
      localStorage.setItem('is_admin', data.is_admin || false);
      showProfile();
    } else {
      alert(data.error);
    }
  }

  async function showProfile() {
    const uid = localStorage.getItem('uid');
    if (!uid) return alert("Вы не авторизованы");

    const res = await fetch(`http://localhost:3000/api/profile/${uid}`);
    const data = await res.json();

    document.getElementById('mainBlock').classList.add('hidden');
    document.getElementById('products').classList.add('hidden');
    document.getElementById('profile')?.remove();

    const profile = document.createElement('section');
    profile.id = 'profile';
    profile.className = 'py-16 px-4 fade-in';
    profile.innerHTML = `
      <h2 class="text-3xl font-bold text-center mb-8">Профиль</h2>
      <div class="max-w-xl mx-auto text-white bg-gray-900 p-6 rounded-xl">
        <p><strong>Ник:</strong> ${data.user.nickname}</p>
        <p><strong>UID:</strong> ${data.user.uid}</p>
        <p><strong>Дата регистрации:</strong> ${new Date(data.user.registered_at).toLocaleString()}</p>
        <hr class="my-4">
        <h3 class="text-xl mb-2">Покупки:</h3>
        <ul>
          ${data.purchases.length ? data.purchases.map(p => `<li>${p.product} — ${new Date(p.purchased_at).toLocaleDateString()}</li>`).join('') : '<li>Нет покупок</li>'}
        </ul>
      </div>`;
    document.body.appendChild(profile);
  }

  // Автодобавление кнопки "Админка", если is_admin === true
  window.addEventListener("DOMContentLoaded", () => {
    if (localStorage.getItem('is_admin') === 'true') {
      const nav = document.querySelector("nav");
      const link = document.createElement("a");
      link.href = "/admin.html";
      link.className = "text-green-400";
      link.innerText = "Админка";
      nav.appendChild(link);
    }
  });
</script>

</body>
</html>
